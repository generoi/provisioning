---
# Part: User
#
# Description: Manage active and departed users of a single group type. This
# should most likely be included twice, once for administrative users and once
# for regular users.
#
# Parameters:
#
# Dependencies:
#
# Creates:
#
# File modifications:
#
###############################################################################

- name: Set default shell to /bin/bash
  command: useradd -D -s /bin/bash
  changed_when: false
  tags:
    - config

# Admins
###
- include: create-users.yml
  vars:
    users: '{{ user_accounts.admins.active }}'
    user_groups: '{{ user_accounts.admins.groups }}'
  when: user_accounts.admins.active is defined

- include: dotfiles.yml
  vars:
    users: '{{ user_accounts.admins.active }}'
  when: user_accounts.admins.active is defined

- include: delete-users.yml
  vars:
    users: '{{ user_accounts.admins.departed }}'
  when: user_accounts.admins.departed is defined

# Regular
###

- include: create-users.yml
  vars:
    users: '{{ user_accounts.regular.active }}'
    user_groups: '{{ user_accounts.regular.groups }}'
  when: user_accounts.regular.active is defined

- include: dotfiles.yml
  vars:
    users: '{{ user_accounts.regular.active }}'
  when: user_accounts.regular.active is defined

- include: delete-users.yml
  vars:
    users: '{{ user_accounts.regular.departed }}'
  when: user_accounts.regular.departed is defined

# Managed
###

- include: create-managed-users.yml
  vars:
    users: '{{ user_accounts.managed }}'
  when: user_accounts.managed is defined

- include: dotfiles.yml
  vars:
    users: '{{ user_accounts.managed }}'
  when: user_accounts.managed is defined

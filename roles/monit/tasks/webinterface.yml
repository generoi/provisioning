---
# Part: Monit
#
# Description: Set up monit webinterface
#
# Parameters:
# - webinterface.enabled: Enable the webinterface for monit (default: false)
# - webinterface.rw_group: A user group which has read and write access (default: sudo)
# - webinterface.r_group: A user group which has read only access (default: admin)
# - webinterface.port: Port for webinterface to listen to (default: 2812)
# - webinterface.bind: Address to bind to (default: 0.0.0.0)
#
# Dependencies:
# - tasks:main
#
# Creates:
#
# File modifications:
# - /etc/monit/conf.d/webinterface
#
###############################################################################

- name: monit | Setup Webinterface: /etc/monit/conf.d/webinterface
  template:
    src=webinterface.j2
    dest=/etc/monit/conf.d/webinterface
  notify: restart monit
  when: webinterface.enabled
  tags:
    - config
    - enable

- name: monit | Disable webinterface: delete /etc/monit/conf.d/webinterface
  file:
    path=/etc/monit/conf.d/webinterface
    state=absent
  notify: restart monit
  when: not webinterface.enabled
  tags:
    - config
    - disable

- name: Monit | Add RW Group: {{ webinterface.rw_group }}
  group:
    name={{ webinterface.rw_group }}
    state=present
  tags:
    - acl

- name: Monit | Add R Group: {{ webinterface.r_group }}
  group:
    name={{ webinterface.r_group }}
    state=present
  tags:
    - acl
